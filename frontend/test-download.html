<!DOCTYPE html>
<html>
<head>
    <title>Download Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/4.1.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.39/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <h1>PDF Download Test</h1>
    <button onclick="testBiomarkersDownload()">Test Biomarkers PDF</button>
    <button onclick="testMedicationsDownload()">Test Medications PDF</button>
    
    <script>
        function testBiomarkersDownload() {
            try {
                const doc = new jsPDF();
                const pageHeight = doc.internal.pageSize.height;
                const pageWidth = doc.internal.pageSize.width;
                let yPosition = 20;

                // Title
                doc.setFontSize(20);
                doc.setFont(undefined, "bold");
                doc.text("Medical Biomarkers Report", pageWidth / 2, yPosition, { align: "center" });
                yPosition += 15;

                // Header Info
                doc.setFontSize(10);
                doc.setFont(undefined, "normal");
                doc.text(`User: test@example.com`, 20, yPosition);
                yPosition += 7;
                doc.text(`Export Date: February 17, 2026`, 20, yPosition);
                yPosition += 7;
                doc.text(`Total Entries: 3`, 20, yPosition);
                yPosition += 7;
                doc.text(`Period: February 1, 2026 to February 17, 2026`, 20, yPosition);
                yPosition += 12;

                // Test data
                const tableData = [
                    ["2026-02-17", "09:00 AM", "Blood Pressure", "120/80", "mmHg", "< 120/80", "Normal reading"],
                    ["2026-02-16", "09:15 AM", "Blood Sugar", "95", "mg/dL", "70-100", "Fasting"],
                    ["2026-02-15", "10:00 AM", "Heart Rate", "72", "bpm", "60-100", "At rest"]
                ];

                doc.autoTable({
                    startY: yPosition,
                    head: [["Date", "Time", "Biomarker", "Reading", "Unit", "Normal Range", "Notes"]],
                    body: tableData,
                    theme: "grid",
                    columnStyles: {
                        0: { cellWidth: 25 },
                        1: { cellWidth: 18 },
                        2: { cellWidth: 30 },
                        3: { cellWidth: 20 },
                        4: { cellWidth: 15 },
                        5: { cellWidth: 30 },
                        6: { cellWidth: 40 }
                    },
                    font: { size: 9 },
                    headStyles: {
                        fillColor: [59, 130, 246],
                        textColor: [255, 255, 255],
                        fontStyle: "bold"
                    },
                    alternateRowStyles: {
                        fillColor: [240, 248, 255]
                    }
                });

                // Add page numbers
                const pageCount = doc.internal.getPages().length;
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(9);
                    doc.setFont(undefined, "italic");
                    doc.text(`Page ${i} of ${pageCount}`, pageWidth / 2, pageHeight - 10, { align: "center" });
                }

                doc.save("biomarkers_test_last30days_2026-02-17.pdf");
                alert("Biomarkers PDF downloaded successfully!");
            } catch (error) {
                alert("Error: " + error.message);
                console.error("Error:", error);
            }
        }

        function testMedicationsDownload() {
            try {
                const doc = new jsPDF();
                const pageHeight = doc.internal.pageSize.height;
                const pageWidth = doc.internal.pageSize.width;
                let yPosition = 20;

                // Title
                doc.setFontSize(20);
                doc.setFont(undefined, "bold");
                doc.text("Medication Tracker Report", pageWidth / 2, yPosition, { align: "center" });
                yPosition += 15;

                // Header Info
                doc.setFontSize(10);
                doc.setFont(undefined, "normal");
                doc.text(`User: test@example.com`, 20, yPosition);
                yPosition += 7;
                doc.text(`Tracked Date: 2026-02-17`, 20, yPosition);
                yPosition += 7;

                // Test summary table
                const summaryData = [
                    ["Aspirin", "500mg", "Tablet", "1", "daily", "1/1", "100%"],
                    ["Metformin", "1000mg", "Tablet", "2", "twice-daily", "2/2", "100%"]
                ];

                doc.autoTable({
                    startY: yPosition,
                    head: [["Medication", "Concentration", "Medium", "Dosage", "Frequency", "Doses", "Adherence %"]],
                    body: summaryData,
                    theme: "grid",
                    columnStyles: {
                        0: { cellWidth: 35 },
                        1: { cellWidth: 25 },
                        2: { cellWidth: 20 },
                        3: { cellWidth: 25 },
                        4: { cellWidth: 30 },
                        5: { cellWidth: 25 },
                        6: { cellWidth: 20 }
                    },
                    font: { size: 9 },
                    headStyles: {
                        fillColor: [34, 197, 94],
                        textColor: [255, 255, 255],
                        fontStyle: "bold"
                    },
                    alternateRowStyles: {
                        fillColor: [240, 253, 244]
                    }
                });

                doc.addPage();
                doc.setFontSize(14);
                doc.setFont(undefined, "bold");
                doc.text("Detailed Dose Schedule", 20, 20);

                // Add page numbers
                const pageCount = doc.internal.getPages().length;
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(9);
                    doc.setFont(undefined, "italic");
                    doc.text(`Page ${i} of ${pageCount}`, pageWidth / 2, pageHeight - 10, { align: "center" });
                }

                doc.save("medications_test_2026-02-17.pdf");
                alert("Medications PDF downloaded successfully!");
            } catch (error) {
                alert("Error: " + error.message);
                console.error("Error:", error);
            }
        }
    </script>
</body>
</html>
